enable
configure terminal
hostname Office-RT
enable secret adminnimda123456


ip domain-name cisco.com
crypto key generate rsa modulus 2048
ip ssh version 2
username admin privilege 15 secret adminnimda123456
line vty 0 4
transport input ssh
login local


ip access-list standard SSH_ACCESS_RULES
permit 192.168.99.0 0.0.0.255
permit 192.168.30.0 0.0.0.255

line vty 0 4
access-class SSH_ACCESS_RULES in


interface g0/0
ip address 99.99.99.2 255.255.255.252
ip nat outside
no shutdown


ip route 0.0.0.0 0.0.0.0 g0/0


interface g0/1.10
encapsulation dot1Q 10
ip address 192.168.10.1 255.255.255.0
ip nat inside

interface g0/1.20
encapsulation dot1Q 20
ip address 192.168.20.1 255.255.255.0
ip nat inside

interface g0/1.30
encapsulation dot1Q 30
ip address 192.168.30.1 255.255.255.0
ip nat inside

interface g0/1.40
encapsulation dot1Q 40
ip address 192.168.40.1 255.255.255.0
ip nat inside

interface g0/1.50
encapsulation dot1Q 50
ip address 192.168.50.1 255.255.255.0
ip nat inside

interface g0/1.60
encapsulation dot1Q 60
ip address 192.168.60.1 255.255.255.0
ip nat inside

interface g0/1.100
encapsulation dot1Q 100
ip address 192.168.100.1 255.255.255.0
ip nat inside

interface g0/1.99
encapsulation dot1Q 99
ip address 192.168.99.1 255.255.255.0

interface g0/1
no shutdown


ip dhcp excluded-address 192.168.10.1 192.168.10.50
ip dhcp excluded-address 192.168.20.1 192.168.20.50
ip dhcp excluded-address 192.168.30.1 192.168.30.50
ip dhcp excluded-address 192.168.40.1 192.168.40.50
ip dhcp excluded-address 192.168.50.1 192.168.50.50
ip dhcp excluded-address 192.168.60.1 192.168.60.50
ip dhcp excluded-address 192.168.100.1 192.168.100.50
ip dhcp excluded-address 192.168.99.1 192.168.99.50

ip dhcp pool VLAN10
network 192.168.10.0 255.255.255.0
default-router 192.168.10.1

ip dhcp pool VLAN20
network 192.168.20.0 255.255.255.0
default-router 192.168.20.1

ip dhcp pool VLAN30
network 192.168.30.0 255.255.255.0
default-router 192.168.30.1

ip dhcp pool VLAN40
network 192.168.40.0 255.255.255.0
default-router 192.168.40.1

ip dhcp pool VLAN50
network 192.168.50.0 255.255.255.0
default-router 192.168.50.1

ip dhcp pool VLAN60
network 192.168.60.0 255.255.255.0
default-router 192.168.60.1

ip dhcp pool VLAN100
network 192.168.100.0 255.255.255.0
default-router 192.168.100.1

ip dhcp pool VLAN99
network 192.168.99.0 255.255.255.0
default-router 192.168.99.1


ip access-list extended VLAN10_RULES
permit udp any any eq 67
permit udp any any eq 68
permit ip 192.168.10.0 0.0.0.255 192.168.60.0 0.0.0.255
deny ip 192.168.10.0 0.0.0.255 192.168.20.0 0.0.0.255
deny ip 192.168.10.0 0.0.0.255 192.168.30.0 0.0.0.255
deny ip 192.168.10.0 0.0.0.255 192.168.40.0 0.0.0.255
deny ip 192.168.10.0 0.0.0.255 192.168.50.0 0.0.0.255 
deny ip 192.168.10.0 0.0.0.255 192.168.100.0 0.0.0.255 
deny ip 192.168.10.0 0.0.0.255 192.168.99.0 0.0.0.255
permit ip 192.168.10.0 0.0.0.255 any
 
ip access-list extended VLAN20_RULES
permit udp any any eq 67
permit udp any any eq 68
permit ip 192.168.20.0 0.0.0.255 192.168.60.0 0.0.0.255
deny ip 192.168.20.0 0.0.0.255 192.168.10.0 0.0.0.255
deny ip 192.168.20.0 0.0.0.255 192.168.30.0 0.0.0.255
deny ip 192.168.20.0 0.0.0.255 192.168.40.0 0.0.0.255
deny ip 192.168.20.0 0.0.0.255 192.168.50.0 0.0.0.255 
deny ip 192.168.20.0 0.0.0.255 192.168.100.0 0.0.0.255
deny ip 192.168.20.0 0.0.0.255 192.168.99.0 0.0.0.255 
permit ip 192.168.20.0 0.0.0.255 any

ip access-list extended VLAN30_RULES
permit udp any any eq 67
permit udp any any eq 68
permit ip 192.168.30.0 0.0.0.255 192.168.60.0 0.0.0.255
permit ip 192.168.30.0 0.0.0.255 192.168.99.0 0.0.0.255
deny ip 192.168.30.0 0.0.0.255 192.168.10.0 0.0.0.255
deny ip 192.168.30.0 0.0.0.255 192.168.20.0 0.0.0.255
deny ip 192.168.30.0 0.0.0.255 192.168.40.0 0.0.0.255
deny ip 192.168.30.0 0.0.0.255 192.168.50.0 0.0.0.255 
deny ip 192.168.30.0 0.0.0.255 192.168.100.0 0.0.0.255 
permit ip 192.168.30.0 0.0.0.255 any

ip access-list extended VLAN40_RULES
permit udp any any eq 67
permit udp any any eq 68
permit ip 192.168.40.0 0.0.0.255 192.168.60.0 0.0.0.255
deny ip 192.168.40.0 0.0.0.255 192.168.10.0 0.0.0.255
deny ip 192.168.40.0 0.0.0.255 192.168.20.0 0.0.0.255
deny ip 192.168.40.0 0.0.0.255 192.168.30.0 0.0.0.255
deny ip 192.168.40.0 0.0.0.255 192.168.50.0 0.0.0.255 
deny ip 192.168.40.0 0.0.0.255 192.168.99.0 0.0.0.255 
permit ip 192.168.40.0 0.0.0.255 any

ip access-list extended VLAN50_RULES
permit udp any any eq 67
permit udp any any eq 68
permit ip 192.168.50.0 0.0.0.255 192.168.60.0 0.0.0.255
deny ip 192.168.50.0 0.0.0.255 192.168.10.0 0.0.0.255
deny ip 192.168.50.0 0.0.0.255 192.168.20.0 0.0.0.255
deny ip 192.168.50.0 0.0.0.255 192.168.30.0 0.0.0.255
deny ip 192.168.50.0 0.0.0.255 192.168.40.0 0.0.0.255 
deny ip 192.168.50.0 0.0.0.255 192.168.100.0 0.0.0.255 
deny ip 192.168.50.0 0.0.0.255 192.168.99.0 0.0.0.255 
permit ip 192.168.50.0 0.0.0.255 any

ip access-list extended VLAN60_RULES
permit udp any any eq 67
permit udp any any eq 68

ip access-list extended VLAN100_RULES
permit udp any any eq 67
permit udp any any eq 68
deny ip 192.168.100.0 0.0.0.255 192.168.10.0 0.0.0.255
deny ip 192.168.100.0 0.0.0.255 192.168.20.0 0.0.0.255
deny ip 192.168.100.0 0.0.0.255 192.168.30.0 0.0.0.255
deny ip 192.168.100.0 0.0.0.255 192.168.40.0 0.0.0.255
deny ip 192.168.100.0 0.0.0.255 192.168.50.0 0.0.0.255 
deny ip 192.168.100.0 0.0.0.255 192.168.60.0 0.0.0.255
deny ip 192.168.100.0 0.0.0.255 192.168.99.0 0.0.0.255
permit ip 192.168.100.0 0.0.0.255 any

ip access-list extended VLAN99_RULES
permit udp any any eq 67
permit udp any any eq 68
permit ip 192.168.99.0 0.0.0.255 192.168.30.0 0.0.0.255

interface g0/1.10 
ip access-group VLAN10_RULES in

interface g0/1.20
ip access-group VLAN20_RULES in

interface g0/1.30  
ip access-group VLAN30_RULES in

interface g0/1.40
ip access-group VLAN40_RULES in

interface g0/1.50  
ip access-group VLAN50_RULES in

interface g0/1.60  
ip access-group VLAN60_RULES in

interface g0/1.100 
ip access-group VLAN100_RULES in

interface g0/1.99 
ip access-group VLAN99_RULES in


ip access-list extended NAT_RULES
deny ip 192.168.40.0 0.0.0.255 10.0.0.0 0.0.0.255
permit ip 192.168.10.0 0.0.0.255 any
permit ip 192.168.20.0 0.0.0.255 any
permit ip 192.168.30.0 0.0.0.255 any
permit ip 192.168.40.0 0.0.0.255 any
permit ip 192.168.50.0 0.0.0.255 any
permit ip 192.168.100.0 0.0.0.255 any

ip nat inside source list NAT_RULES interfaceerface g0/0 overload


ip access-list extended IPSEC_VPN_RULES
permit ip 192.168.40.0 0.0.0.255 10.0.0.0 0.0.0.255
crypto isakmp policy 10
encryption aes 256
authentication pre-share
group 5
exit
crypto isakmp key vpnpa55 address 77.77.77.2
crypto ipsec transform-set VPN-SET esp-aes esp-sha-hmac
crypto map VPN-MAP 10 ipsec-isakmp
description VPN connection to Headquarter-RT
set peer 77.77.77.2
set transform-set VPN-SET
match address IPSEC_VPN_RULES
exit
interfaceerface g0/0
crypto map VPN-MAP